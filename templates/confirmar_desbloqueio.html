<!-- templates/confirmar_desbloqueio.html -->
{% extends "base.html" %}
{% block title %}ğŸ”“ Confirmar Desbloqueio â€” T-Lux{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card card-tlux p-4 shadow-lg border-0">

        <!-- CabeÃ§alho -->
        <div class="text-center mb-4">
          <img src="{{ url_for('static', filename='img/logo.png') }}" alt="T-Lux Logo" height="50" class="mb-2">
          <h3 class="gold-text fw-bold">ğŸ”“ ConfirmaÃ§Ã£o do Desbloqueio</h3>
          <p class="text-muted mb-0">Revise os detalhes abaixo antes de prosseguir com o pagamento.</p>
        </div>

        <!-- Mensagens de feedback -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-3">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Resumo -->
        <div class="table-responsive mb-4">
          <table class="table table-hover align-middle border">
            <tbody>
              <tr>
                <th class="bg-light fw-semibold text-primary">ğŸ“± Serial / IMEI</th>
                <td class="fw-bold">{{ serial }}</td>
              </tr>
              <tr>
                <th class="bg-light fw-semibold text-primary">ğŸ“² Modelo Detectado</th>
                <td class="fw-bold">{{ modelo }}</td>
              </tr>
              <tr>
                <th class="bg-light fw-semibold text-primary">ğŸ’° PreÃ§o Total</th>
                <td>
                  <span class="fw-bold text-success fs-5">{{ preco_cliente }} {{ currency }}</span><br>
                  {% if preco_fornecedor %}
                    <small class="text-muted">Fornecedor: {{ preco_fornecedor }} {{ currency }}</small>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <th class="bg-light fw-semibold text-primary">ğŸ“ˆ Lucro Estimado</th>
                <td>
                  <span class="fw-bold text-gold">{{ lucro }} {{ currency }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Detalhes tÃ©cnicos (API) -->
        {% if detalhes_api %}
          <div class="border rounded-3 p-3 bg-light mb-4">
            <h6 class="fw-bold text-primary mb-2">ğŸ“‹ Detalhes TÃ©cnicos</h6>
            <ul class="list-unstyled mb-0 small">
              {% for chave, valor in detalhes_api.items() %}
                <li class="d-flex justify-content-between py-1 border-bottom">
                  <span>{{ chave }}</span>
                  <span class="fw-semibold">{{ valor }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <!-- BotÃµes de aÃ§Ã£o -->
        <form method="POST" action="{{ url_for('pagar_desbloqueio') }}">
          <input type="hidden" name="serial" value="{{ serial }}">
          <input type="hidden" name="modelo" value="{{ modelo }}">
          <button type="submit" class="btn btn-tlux w-100 fw-bold py-2 fs-5">
            ğŸ’³ Confirmar e Pagar Agora
          </button>
        </form>

        <div class="text-center mt-3">
          <a href="{{ url_for('verificar_serial') }}" class="btn btn-outline-gold px-4">
            â¬… Voltar e Corrigir
          </a>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Pequeno efeito visual -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.querySelector("form");
  form.addEventListener("submit", () => {
    const btn = form.querySelector("button[type='submit']");
    btn.innerHTML = "â³ Processando pagamento...";
    btn.disabled = true;
  });
});
</script>
{% endblock %}
